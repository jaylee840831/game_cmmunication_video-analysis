<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ball game</title>
<link rel="stylesheet"  href="/css/navigationbar.css">
<link rel="stylesheet" href="/css/chat_game.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.0/handlebars.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.12/vue.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link href= "https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
 <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap4.min.css">
 <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap4.min.css">
 <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
 <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
 <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap4.min.js"></script>
 <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
 <script src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap4.min.js"></script>
 <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" type="text/css" rel="stylesheet">
  <!--    libs for stomp and sockjs-->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.4.0/sockjs.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
 <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
</head>
<body>

<div id="wrapper">
	<nav id="sidebar">
		<div class="sidebar-header">
			<h5><a href="/">首頁</a></h5>
		</div>
		<ul class="lisst-unstyled components">
			<li>
				<a href="/person">個人資料</a>
			</li>
			<li>
				<a href="#">發起球局</a>
			</li>
			<li>
				<a href="#">球局歷史紀錄</a>
			</li>
			<li>
				<a href="#">影片分析</a>
			</li>
			<li>
				<a href="/chat">聊天室</a>
			</li>
			<li>
				<a id="logout" href="/logout">登入</a>
			</li>
		</ul>
	</nav>
	
	<div id="content">
	
		<nav class="navbar navbar-expand-lg">
			<div class="container-fluid">
				<button type="button" id="sidebarCollapse" class="btn" style="position:absolute;">
					<img src="/images/navigation-icon.png">	
				</button>
			</div>
		</nav>
		
		<br/>
		
			<div>
					<table id="data_table" class="table">
						<!-- 動態生成球局資料 -->
					</table>
				</div>
			<div>
				<!-- 進入聊天 -->
		    <div id="username-page">
		        <div class="username-page-container">
		            <form id="usernameForm" name="usernameForm">
		                <div class="form-group">
		                    <input type="text" id="name" placeholder="" autocomplete="off" class="form-control" readonly="readonly"/>
		                </div>
		                <div class="form-group">
		                    <button type="submit" class="btn btn-success username-submit">開始聊天</button>
		                </div>
		            </form>
		        </div>
		    </div>
			
			<!-- 聊天頁面 -->
		    <div id="chat-page" class="hidden">
		        <div class="chat-container">
		            <div class="chat-header">
		                <h6 style="color:red;">*聊天請注意用字，若是遭其他人檢舉，將停用您的帳號*</h6>
		            </div>
		            <div class="connecting">
		                Connecting...
		            </div>
		            <ul id="messageArea">
		
		            </ul>
		            <form id="messageForm" name="messageForm">
		                <div class="form-group">
		                    <div class="input-group clearfix">
		                        <input type="text" id="message" placeholder="輸入您的訊息" autocomplete="off" class="form-control"/>
		                        <button type="submit" class="btn btn-dark">Send</button>
		                    </div>
		                </div>
		            </form>
		        </div>
		    </div>
    
			
		</div>
		
</div>

<script>

	window.onload=function(){
	}

	$(document).ready(function(){
	
	//$(".container").fadeIn(3000);
	
	$("#sidebarCollapse").on('click',function(){
		$("#sidebar").toggleClass('active');
	});
	
	$("#sidebarCollapse").animate({left: '-20px'}, "slow");

	
	var get_game='/api/v1/GET/gamedata/'+$.cookie('ball_game_code');
	
	$('#data_table').html('');
	
	$('#data_table').append(
			"<thead class='thead-dark'>"
	            +'<tr>'
	            	+'<th>代號</th>'
	 				+'<th>發起人</th>'
	                +'<th>球局</th>'
	                +'<th>球場</th>'
	                +'<th>注意事項</th>'
	                +'<th>開始時間</th>'
           		+ '</tr>'
    		+'</thead>'
    		+'<tbody>');
	
	//取得球局資料
	$.ajax({
	    type: "GET",
	    url: get_game,
	    dataType: "json",
	    success: function (response) {    	
	    	//console.log(response);
	    	
    		$('#data_table').append(
		            '<tr>'
		            	+'<td>'+response[0].code+'</td>'
		 				+'<td>'+response[0].username+'</td>'
		                +'<td>'+response[0].game+'</td>'
		                +'<td>'+response[0].court+'</td>'
		                +'<td>'+response[0].notice+'</td>'
		                +'<td>'+response[0].time+'</td>'
	           		+ '</tr>'
	           		+'</tbody>'
	           		);
	    },
	    error: function (thrownError) {
	      console.log(thrownError);
	    }
	  });
	
	var get_person='/api/v1/GET/person'	
		//取得使用者資料
		$.ajax({
		    type: "GET",
		    url: get_person,
		    dataType: "json",
		    success: function (response) {
		    	if(response.username!=null){
		    		$('#name').val(response.username);
		    		$("#logout").text("登出");
		    	}
		    },
		    error: function (thrownError) {
		      console.log(thrownError);
		      alert("請先登入帳號");
		      $("#logout").text("登入");
		    }
		  });
	
});
</script>


<script src="js/chat_game.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>